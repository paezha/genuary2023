---
title: "R Notebook"
output: html_notebook
---

For this piece I use the following packages:
```{r setup}
library(dplyr) # A Grammar of Data Manipulation
library(ggplot2) # Create Elegant Data Visualisations Using the Grammar of Graphics
library(glue) # Interpreted String Literals
library(MetBrewer) # Color Palettes Inspired by Works at the Metropolitan Museum of Art 
library(MexBrewer) # Color Palettes Inspired by Works of Mexican Muralists
library(mpoly) # Symbolic Computation and More with Multivariate Polynomials
#library(tidyr)
```

## Generate a random seed

```{r seed}
seed <- sample.int(100000000, 1)
#seed <- 8336784
```

```{r}
set.seed(seed)

n_sine <- sample.int(3, 1)

A <- c(1, 4)#runif(n_sine, 0, 2 * pi)
f <- c(1, 6)#sample.int(10, n_sine, replace = TRUE) |> sort(decreasing = TRUE)
phi <- c(0, 0)# runif(n_sine - 1, 0, 2 * pi))
```

```{r}

#T_period <- LCM(1/f[1], 1/f[2])

#least_common_multiple <- LCM(1/f[1], 1/f[2])

# for(i in 3:n_sine){
#   least_common_multiple <- LCM(1/least_common_multiple, 1/f[i])
# }

T_f <- 2
n_t <- 6000

t <- seq(0, T_f * 2 * pi, length = T_f * n_t)

t2 <- seq(0, 1, length = 1000)

x <- 0  
y <- 0


df <- data.frame(x = numeric(length = T_f * n_t),
                 y = numeric(length = T_f * n_t),
                 theta = numeric(length = T_f * n_t))

df2 <- data.frame(x = numeric(length = 1000),
                 y = numeric(length = 1000),
                 theta = numeric(length = 1000))

idx <- 0
for(i in t){
  idx <- idx + 1
  theta <- 0
  for(j in 1:n_sine){
    theta <- theta + A[j] * sin(f[j] * t[idx] + phi[j])
  }
  df$x[idx] <- cos(theta)
  df$y[idx] <- sin(theta)
  df$theta[idx] <- theta
}

idx <- 0
for(i in t2){
  idx <- idx + 1
  theta <- 0
  for(j in 1:n_sine){
    theta <- theta + A[j] * sin(f[j] * t[idx] + phi[j])
  }
  df2$x[idx] <- cos(theta)
  df2$y[idx] <- sin(theta)
  df2$theta[idx] <- theta
}


df2 <- df2 |>
  mutate(x = cumsum(x),
         y = cumsum(y))

dxdy <- df2 |> slice_tail(n =1)
mu <- -atan(dxdy$y/dxdy$x)

df <- df |>
  mutate(x = mu + cumsum(x),
         y = mu + cumsum(y))



# Length of stroke
x_range <- max(df$x) - min(df$x)
y_range <- max(df$y) - min(df$y)

l <- max(x_range, y_range)


l <- runif(1, 0.05, 0.15) * l

l_r <- runif(nrow(df), 0.90, 1.10)

# df <- df |>
#   mutate(xstart =  x + l_r * l * sin(theta * runif(n(), 0.97, 1.03)),
#          ystart = y + l_r * l * cos(theta * runif(n(), 0.97, 1.03)),
#          xend = x - l_r * l * sin(theta * runif(n(), 0.97, 1.03)),
         # yend = y - l_r * l * cos(theta * runif(n(), 0.97, 1.03)))

df <- df |>
  mutate(xstart =  x - l_r * l * sin(theta * runif(n(), 0.97, 1.03)),
         ystart = y - l_r * l * cos(theta * runif(n(), 0.97, 1.03)),
         xend = x + l_r * l * sin(theta * runif(n(), 0.97, 1.03)),
         yend = y + l_r * l * cos(theta * runif(n(), 0.97, 1.03)))
```


Randomly select a color palette from package [`MexBrewer`](https://CRAN.R-project.org/package=MexBrewer) or [`MetBrewer`](https://CRAN.R-project.org/package=MetBrewer).
```{r}
set.seed(seed)

color_edition <- sample(c("Monotone", "MetBrewer", "MexBrewer"), 1)

if(color_edition == "Monotone"){
  col_palette <- c("white", "grey", "grey20", "black")
}else if(color_edition == "MetBrewer"){
  col_palette_name <- sample(c("Archambault", "Austria", "Benedictus", "Cassatt1", "Cassatt2", "Cross", "Degas", "Demuth", "Derain", "Egypt", "Gauguin", "Greek", "Hiroshige", "Hokusai1", "Hokusai2", "Hokusai3", "Homer1", "Homer2", "Ingres", "Isfahan1", "Isfahan2", "Java", "Johnson", "Juarez", "Kandinsky", "Klimt", "Lakota", "Manet", "Moreau", "Morgenstern", "Nattier", "Navajo", "NewKingdom", "Nizami", "OKeeffe1", "OKeeffe2", "Paquin", "Peru1", "Peru2", "Pillement", "Pissaro", "Redon", "Renoir", "Signac", "Tam", "Tara", "Thomas", "Tiepolo", "Troy", "Tsimshian", "VanGogh1", "VanGogh2", "VanGogh3", "Veronese", "Wissing"), 1)
  col_palette <- met.brewer(col_palette_name, n = 4)
}else if(color_edition == "MexBrewer"){
  col_palette_name <- sample(c("Alacena", "Atentado", "Aurora", "Casita1", "Casita2", "Casita3", "Concha", "Frida", "Huida", "Maiz", "Ofrenda", "Revolucion", "Ronda", "Taurus1", "Taurus2", "Tierra", "Vendedora"), 1)
  col_palette <- mex.brewer(col_palette_name, n = 4)
}

if(sample(c(TRUE, FALSE), 1)){
  col_palette <- rev(col_palette)
}

```

```{r}
ggplot(data = df) + 
  geom_segment(aes(x = x, y = y,
                   xend = xstart, yend = ystart,
                   #alpha = theta
  ),
  alpha = 0.25,
  color = col_palette[1],
  #color = "gray",
  linewidth = 0) +
  geom_segment(aes(x = x, y = y,
                   xend = xend, yend = yend,
                   #alpha = theta
  ),
  alpha = 0.25,
  color = col_palette[4],
  linewidth = 0) +
  geom_path(aes(x = x,
                y = y),
            color = col_palette[2]
            #color = "white"
              ) +
  coord_equal() +
  theme_void() +
  theme(plot.background = element_rect(color = NA,
                                       fill = col_palette[3]
                                       #fill = "gray20"
                                         ))

if(x_range > y_range){
  # Save plot
  ggsave(filename = glue::glue("outputs/meandering-paths-{seed}.png"),
         width = 7)
  
}else{
  ggsave(filename = glue::glue("outputs/meandering-paths-{seed}.png"),
         height = 7)
}
```

```{r echo=FALSE, out.width="500px"}
# Display image
#knitr::include_graphics(glue::glue("outputs/meandering-paths-{seed}.png"))
```

```{r eval=FALSE}
ggplot(data = df) + 
  geom_segment(aes(x = x, y = y,
                   xend = xstart, yend = ystart,
                   #alpha = theta
  ),
  alpha = 0.25,
  color = col_palette[2],
  #color = "gray",
  linewidth = 0) +
  geom_segment(aes(x = x, y = y,
                   xend = xend, yend = yend,
                   #alpha = theta
  ),
  alpha = 0.25,
  color = "black",
  linewidth = 0) +
  geom_path(aes(x = x,
                y = y),
            color = col_palette[1]
            #color = "white"
              ) +
  coord_polar() +
  theme_void() +
  theme(plot.background = element_rect(color = NA,
                                       fill = col_palette[3]
                                       #fill = "gray20"
                                         ))

# Save plot
  ggsave(filename = glue::glue("outputs/meandering-paths-polar-{seed}.png"),
         height = 7,
         width = 7)
```

```{r echo=FALSE, out.width="500px"}
# Display image
#knitr::include_graphics(glue::glue("outputs/meandering-paths-polar-{seed}.png"))
```

